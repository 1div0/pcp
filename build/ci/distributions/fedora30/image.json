{
  "variables": {
    "subscription_id": "{{env `ARM_SUBSCRIPTION_ID`}}",
    "client_id": "{{env `ARM_CLIENT_ID`}}",
    "client_secret": "{{env `ARM_CLIENT_SECRET`}}",
    "resource_group": "{{env `RESOURCE_GROUP`}}",
    "image_name": "{{env `IMAGE`}}",
    "pcp_commit": "{{env `PCP_COMMIT`}}"
  },
  "sensitive-variables": [
    "client_secret"
  ],
  "builders": [{
    "type": "azure-arm",

    "subscription_id": "{{user `subscription_id`}}",
    "client_id": "{{user `client_id`}}",
    "client_secret": "{{user `client_secret`}}",

    "managed_image_resource_group_name": "{{user `resource_group`}}",
    "managed_image_name": "{{user `image_name`}}",

    "os_type": "Linux",
    "image_publisher": "tunnelbiz",
    "image_offer": "fedora",
    "image_sku": "fedora30",
    "plan_info": {
      "plan_publisher": "tunnelbiz",
      "plan_product": "fedora",
      "plan_name": "fedora30"
    },

    "location": "East US",
    "vm_size": "Standard_DS2_v2",

    "azure_tags": {
      "pcp_commit": "{{user `pcp_commit`}}"
    }
  }],
  "provisioners": [{
    "type": "file",
    "source": "../../../ci",
    "destination": "/tmp"
  }, {
    "type": "shell",
    "environment_vars": [
      "PCP_COMMIT={{user `pcp_commit`}}"
    ],
    "inline": [
      "sudo mv /tmp/ci /usr/local/ci",
      "/usr/local/ci/run_script.sh _provision.sh fedora30"
    ]
  }]
}
