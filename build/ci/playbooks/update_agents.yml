- name: Setup agent network
  hosts: localhost
  tasks:
  - name: Create a virtual network
    azure_rm_virtualnetwork:
      resource_group: "{{ resource_group }}"
      name: agent-network
      address_prefixes_cidr:
          - "10.1.0.0/16"
    delegate_to: localhost
  - name: Create a subnet
    azure_rm_subnet:
      resource_group: "{{ resource_group }}"
      virtual_network_name: agent-network
      name: agent-subnet
      address_prefix_cidr: "10.1.0.0/24"
    delegate_to: localhost

- name: Setup agent images
  hosts: agents
  gather_facts: no
  roles:
  - agent_image_builder
